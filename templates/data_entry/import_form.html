{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "数据导入" %} - {% trans "碳排放管理系统" %}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col">
            <h2><i class="bi bi-upload"></i> {% trans "数据导入" %}</h2>
            <p class="text-muted">{% trans "批量导入物料消耗记录" %}</p>
        </div>
    </div>
    
    <!-- Instructions Card -->
    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0"><i class="bi bi-info-circle"></i> {% trans "导入说明" %}</h5>
        </div>
        <div class="card-body">
            <h6>{% trans "文件格式要求：" %}</h6>
            <ul>
                <li>{% trans "支持 Excel (.xlsx, .xls) 和 CSV (.csv) 格式" %}</li>
                <li>{% trans "文件大小不超过 10MB" %}</li>
                <li>{% trans "必须包含以下列（顺序不限）：" %}
                    <ul>
                        <li><strong>{% trans "酒店名称" %}</strong> - {% trans "酒店的名称" %}</li>
                        <li><strong>{% trans "部门" %}</strong> - {% trans "部门名称（必须是系统中已存在的部门）" %}</li>
                        <li><strong>{% trans "一级分类" %}</strong> - {% trans "产品的一级分类名称" %}</li>
                        <li><strong>{% trans "二级分类" %}</strong> - {% trans "产品的二级分类名称" %}</li>
                        <li><strong>{% trans "产品名称" %}</strong> - {% trans "产品的名称" %}</li>
                        <li><strong>{% trans "消耗日期" %}</strong> - {% trans "格式：YYYY-MM-DD，例如：2024-01-01" %}</li>
                        <li><strong>{% trans "消耗时间" %}</strong> - {% trans "格式：HH:MM:SS 或 HH:MM，例如：10:30:00" %}</li>
                        <li><strong>{% trans "消耗数量" %}</strong> - {% trans "数字，必须大于0" %}</li>
                    </ul>
                </li>
            </ul>
            
            <h6 class="mt-3">{% trans "注意事项：" %}</h6>
            <ul>
                <li>{% trans "部门、分类和产品名称必须与系统中的数据完全匹配" %}</li>
                <li>{% trans "产品必须在对应的分类下存在" %}</li>
                <li>{% trans "日期和时间格式必须正确" %}</li>
                <li>{% trans "导入过程中会自动验证数据，无效的行将被跳过并显示错误信息" %}</li>
            </ul>
            
            <div class="alert alert-warning mt-3">
                <i class="bi bi-exclamation-triangle"></i>
                {% trans "建议先下载模板文件，按照模板格式填写数据后再导入" %}
            </div>
        </div>
    </div>
    
    <!-- Import Form -->
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">{% trans "上传文件" %}</h5>
        </div>
        <div class="card-body">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                
                <div class="mb-3">
                    <label for="{{ form.file.id_for_label }}" class="form-label">
                        {{ form.file.label }}
                    </label>
                    {{ form.file }}
                    {% if form.file.help_text %}
                        <div class="form-text">{{ form.file.help_text }}</div>
                    {% endif %}
                    {% if form.file.errors %}
                        <div class="invalid-feedback d-block">
                            {{ form.file.errors }}
                        </div>
                    {% endif %}
                </div>
                
                <div class="d-flex justify-content-between">
                    <a href="{% url 'consumption_list' %}" class="btn btn-secondary">
                        <i class="bi bi-arrow-left"></i> {% trans "返回列表" %}
                    </a>
                    <button type="submit" class="btn btn-success">
                        <i class="bi bi-upload"></i> {% trans "开始导入" %}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}
